<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Admin Dashboard - Smart Complaint System">
  <title>Admin Dashboard - Smart Complaint System</title>
  
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Navigation -->
  <header>
    <nav class="container flex-between">
      <div class="logo">‚ö° SmartComplaint</div>
      
      <div style="display: flex; align-items: center; gap: 2rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div class="text-right">
            <div id="admin-name" style="font-weight: 600;"></div>
            <small style="color: var(--text-muted);">Administrator</small>
          </div>
          <button class="btn btn-sm" onclick="logout()" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);">
            Logout
          </button>
        </div>
      </div>
    </nav>
  </header>

  <main class="dashboard-layout container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <ul class="sidebar-menu">
        <li class="sidebar-item">
          <a href="#" class="sidebar-link active" onclick="showSection('overview')">
            üìä Overview
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('complaints')">
            üìã Complaints
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('communities')">
            üèòÔ∏è Communities
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('staff')">
            üë• Staff
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('analytics')">
            üìà Analytics
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('audit')">
            üîç Audit Logs
          </a>
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Notifications Container -->
      <div id="notifications-container"></div>

      <!-- Overview Section -->
      <section id="overview-section" class="section">
        <h1 style="margin-bottom: 2rem;">Admin Overview</h1>

        <!-- KPI Cards -->
        <div class="grid grid-4 mb">
          <div class="stat-card">
            <div class="stat-label">Total Complaints</div>
            <div class="stat-number" id="kpi-total">0</div>
            <small id="kpi-total-change" style="color: var(--text-muted);">‚Üë 0% from last month</small>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending</div>
            <div class="stat-number" id="kpi-pending" style="color: var(--warning);">0</div>
            <small style="color: var(--text-muted);">Awaiting assignment</small>
          </div>
          <div class="stat-card">
            <div class="stat-label">Resolution Rate</div>
            <div class="stat-number" id="kpi-resolution" style="color: var(--success);">0%</div>
            <small style="color: var(--text-muted);">Complaints resolved</small>
          </div>
          <div class="stat-card">
            <div class="stat-label">Communities</div>
            <div class="stat-number" id="kpi-communities">0</div>
            <small style="color: var(--text-muted);">Active communities</small>
          </div>
        </div>

        <!-- Charts & Overview -->
        <div class="grid grid-2 mb">
          <div class="card">
            <div class="card-header">
              <h3>Complaints by Status</h3>
            </div>
            <div class="card-body">
              <div id="status-breakdown"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Complaints by Category</h3>
            </div>
            <div class="card-body">
              <div id="category-breakdown"></div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
          <div class="card-header">
            <h3>Recent Complaints</h3>
          </div>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Community</th>
                  <th>Status</th>
                  <th>Priority</th>
                  <th>Assigned To</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="overview-complaints-table">
                <tr>
                  <td colspan="6" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                    Loading...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Complaints Management Section -->
      <section id="complaints-section" class="section hidden">
        <div class="flex-between mb">
          <h1>Complaint Management</h1>
          <div style="display: flex; gap: 1rem;">
            <input 
              type="text" 
              id="search-complaints" 
              placeholder="Search complaints..." 
              style="width: 250px;"
              onkeyup="filterComplaints()"
            >
          </div>
        </div>

        <!-- Filter Panel -->
        <div class="card mb">
          <div class="grid grid-4" style="gap: 1rem;">
            <div>
              <label>Status</label>
              <select onchange="filterComplaints()">
                <option value="">All Statuses</option>
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="On Hold">On Hold</option>
                <option value="Resolved">Resolved</option>
              </select>
            </div>
            <div>
              <label>Priority</label>
              <select onchange="filterComplaints()">
                <option value="">All Priorities</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Urgent">Urgent</option>
              </select>
            </div>
            <div>
              <label>Category</label>
              <select onchange="filterComplaints()">
                <option value="">All Categories</option>
                <option value="Infrastructure">Infrastructure</option>
                <option value="Cleanliness">Cleanliness</option>
                <option value="Security">Security</option>
                <option value="Utilities">Utilities</option>
                <option value="Maintenance">Maintenance</option>
                <option value="Noise">Noise</option>
              </select>
            </div>
            <div>
              <label>Community</label>
              <select id="community-filter" onchange="filterComplaints()">
                <option value="">All Communities</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Complaints Table -->
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Community</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Assigned To</th>
                <th>Created</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="complaints-table">
              <tr>
                <td colspan="8" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                  Loading complaints...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Communities Section -->
      <section id="communities-section" class="section hidden">
        <div class="flex-between mb">
          <h1>Community Management</h1>
          <button class="btn btn-primary btn-sm" onclick="showCreateCommunityModal()">
            ‚ûï New Community
          </button>
        </div>

        <div class="grid grid-2">
          <div id="communities-list"></div>
        </div>
      </section>

      <!-- Staff Section -->
      <section id="staff-section" class="section hidden">
        <h1 style="margin-bottom: 2rem;">Staff Management</h1>

        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Community</th>
                <th>Complaints Assigned</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="staff-table">
              <tr>
                <td colspan="5" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                  Loading staff...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Analytics Section -->
      <section id="analytics-section" class="section hidden">
        <h1 style="margin-bottom: 2rem;">Analytics & Reports</h1>

        <div class="grid grid-2 mb">
          <div class="card">
            <div class="card-header">
              <h3>Performance Metrics</h3>
            </div>
            <div class="card-body">
              <div style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Average Resolution Time</span>
                  <strong id="avg-resolution">0 days</strong>
                </div>
              </div>
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Overall Resolution Rate</span>
                  <strong id="overall-resolution">0%</strong>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>System Statistics</h3>
            </div>
            <div class="card-body">
              <div style="margin-bottom: 1rem;">
                <span>Total Users:</span> <strong id="stat-total-users">0</strong>
              </div>
              <div>
                <span>Active Communities:</span> <strong id="stat-active-communities">0</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Complaints Trend (Last 30 Days)</h3>
          </div>
          <div class="card-body">
            <div id="trend-chart" style="text-align: center; color: var(--text-muted);">
              üìä Chart data will be displayed here
            </div>
          </div>
        </div>
      </section>

      <!-- Audit Logs Section -->
      <section id="audit-section" class="section hidden">
        <h1 style="margin-bottom: 2rem;">Audit Logs</h1>

        <div class="card mb">
          <div class="grid grid-3" style="gap: 1rem;">
            <div>
              <label>Filter by Action</label>
              <select id="audit-action-filter" onchange="filterAuditLogs()">
                <option value="">All Actions</option>
                <option value="CREATE_COMMUNITY">Create Community</option>
                <option value="UPDATE_COMMUNITY">Update Community</option>
                <option value="DELETE_COMMUNITY">Delete Community</option>
                <option value="ASSIGN_COMPLAINT">Assign Complaint</option>
                <option value="UPDATE_STATUS">Update Status</option>
                <option value="ADD_NOTE">Add Note</option>
              </select>
            </div>
            <div>
              <label>Filter by Admin</label>
              <select id="audit-admin-filter" onchange="filterAuditLogs()">
                <option value="">All Admins</option>
              </select>
            </div>
            <div>
              <label>Date Range</label>
              <input type="date" id="audit-date-filter" onchange="filterAuditLogs()">
            </div>
          </div>
        </div>

        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Admin</th>
                <th>Action</th>
                <th>Entity</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="audit-table">
              <tr>
                <td colspan="5" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                  Loading audit logs...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <!-- Complaint Detail Modal -->
  <div id="complaint-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2 id="modal-title">Complaint Details</h2>
        <button class="modal-close" onclick="closeModal('complaint-modal')">‚úï</button>
      </div>
      <div id="modal-body" class="card-body"></div>
      <div class="card-footer" style="gap: 0.5rem;">
        <select id="status-select" style="flex: 1;" onchange="updateComplaintStatus()">
          <option value="">Change Status...</option>
          <option value="Pending">Pending</option>
          <option value="In Progress">In Progress</option>
          <option value="On Hold">On Hold</option>
          <option value="Resolved">Resolved</option>
        </select>
        <select id="staff-select" style="flex: 1;" onchange="assignComplaintToStaff()">
          <option value="">Assign to Staff...</option>
        </select>
      </div>
      <div class="card-body" style="border-top: 1px solid rgba(255,255,255,0.1);">
        <label>Add Admin Note</label>
        <textarea id="admin-note" placeholder="Add a note..." style="margin-bottom: 0.5rem;"></textarea>
        <button class="btn btn-secondary" onclick="addAdminNote()">Add Note</button>
      </div>
    </div>
  </div>

  <!-- Create Community Modal -->
  <div id="community-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Create New Community</h2>
        <button class="modal-close" onclick="closeModal('community-modal')">‚úï</button>
      </div>
      <form id="community-form" class="card-body">
        <div class="form-group">
          <label>Community Name *</label>
          <input type="text" id="comm-name" placeholder="Enter community name" required>
        </div>
        <div class="form-group">
          <label>Location *</label>
          <input type="text" id="comm-location" placeholder="Enter location" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="comm-description" placeholder="Community description"></textarea>
        </div>
        <div class="flex gap">
          <button type="submit" class="btn btn-primary" style="flex: 1;">Create</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('community-modal')" style="flex: 1;">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/user.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/realtime.js"></script>
  
  <script>
    let currentComplaintId = null;
    
    // Initialize admin dashboard
    function initAdminDashboard() {
      if (!Auth.isAdmin()) {
        window.location.href = 'user-dashboard.html';
        return;
      }
      
      document.getElementById('admin-name').textContent = Auth.currentUser.name;
      
      loadOverview();
      loadComplaints();
      loadCommunities();
      loadStaff();
      loadAuditLogs();
      setupRealTimeUpdates();
    }
    
    function loadOverview() {
      const analytics = Admin.getAnalytics();
      
      document.getElementById('kpi-total').textContent = analytics.totalComplaints;
      document.getElementById('kpi-pending').textContent = analytics.byStatus.pending;
      document.getElementById('kpi-resolution').textContent = analytics.resolutionRate + '%';
      document.getElementById('kpi-communities').textContent = Admin.communities.length;
      
      renderStatusBreakdown(analytics.byStatus);
      renderCategoryBreakdown(analytics.byCategory);
      loadOverviewComplaints();
    }
    
    function renderStatusBreakdown(data) {
      const container = document.getElementById('status-breakdown');
      container.innerHTML = Object.entries(data).map(([status, count]) => {
        const total = data.pending + data.inProgress + data.onHold + data.resolved;
        const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
        return `
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span>${status}</span>
              <strong>${count}</strong>
            </div>
            <div style="height: 8px; background: var(--glass); border-radius: 4px; overflow: hidden;">
              <div style="width: ${percentage}%; height: 100%; background: linear-gradient(90deg, var(--primary-blue), var(--accent-yellow));"></div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function renderCategoryBreakdown(data) {
      const container = document.getElementById('category-breakdown');
      container.innerHTML = Object.entries(data).map(([category, count]) => `
        <div style="margin-bottom: 0.75rem; display: flex; justify-content: space-between;">
          <span>${category}</span>
          <strong>${count}</strong>
        </div>
      `).join('');
    }
    
    function loadOverviewComplaints() {
      const complaints = Admin.getAllComplaints().slice(0, 5);
      const tbody = document.getElementById('overview-complaints-table');
      
      if (complaints.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center" style="color: var(--text-muted); padding: 2rem;">No complaints</td></tr>';
        return;
      }
      
      tbody.innerHTML = complaints.map(c => `
        <tr>
          <td>${c.title}</td>
          <td>${Admin.getCommunityName(c.communityId)}</td>
          <td><span class="badge badge-${getStatusColor(c.status)}">${c.status}</span></td>
          <td><span class="badge badge-${getPriorityColor(c.priority)}">${c.priority}</span></td>
          <td>${c.assignedTo ? 'Assigned' : 'Unassigned'}</td>
          <td><button class="btn btn-sm btn-primary" onclick="showComplaintModal('${c.id}')">View</button></td>
        </tr>
      `).join('');
    }
    
    function loadComplaints() {
      const complaints = Admin.getAllComplaints();
      populateCommunityFilter();
      renderComplaintsTable(complaints);
    }
    
    function renderComplaintsTable(complaints) {
      const tbody = document.getElementById('complaints-table');
      
      if (complaints.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center" style="color: var(--text-muted); padding: 2rem;">No complaints found</td></tr>';
        return;
      }
      
      tbody.innerHTML = complaints.map(c => `
        <tr onclick="showComplaintModal('${c.id}')" style="cursor: pointer;">
          <td><small>${c.id}</small></td>
          <td><strong>${c.title}</strong></td>
          <td><small>${Admin.getCommunityName(c.communityId)}</small></td>
          <td><span class="badge badge-${getStatusColor(c.status)}">${c.status}</span></td>
          <td><span class="badge badge-${getPriorityColor(c.priority)}">${c.priority}</span></td>
          <td>${c.assignedTo ? 'Yes' : 'No'}</td>
          <td><small>${new Date(c.createdAt).toLocaleDateString()}</small></td>
          <td><button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); showComplaintModal('${c.id}')">Edit</button></td>
        </tr>
      `).join('');
    }
    
    function filterComplaints() {
      const status = document.querySelector('[onchange="filterComplaints()"]')?.value || '';
      const priority = document.querySelectorAll('[onchange="filterComplaints()"]')[1]?.value || '';
      const category = document.querySelectorAll('[onchange="filterComplaints()"]')[2]?.value || '';
      const community = document.getElementById('community-filter')?.value || '';
      const search = document.getElementById('search-complaints')?.value || '';
      
      let complaints = Admin.getAllComplaints(
        { status, priority, category, communityId: community }
      );
      
      if (search) {
        complaints = complaints.filter(c => 
          c.title.toLowerCase().includes(search.toLowerCase()) ||
          c.description.toLowerCase().includes(search.toLowerCase()) ||
          c.id.includes(search)
        );
      }
      
      renderComplaintsTable(complaints);
    }
    
    function populateCommunityFilter() {
      const select = document.getElementById('community-filter');
      select.innerHTML = '<option value="">All Communities</option>' +
        Admin.communities.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    }
    
    function loadCommunities() {
      const container = document.getElementById('communities-list');
      
      if (Admin.communities.length === 0) {
        container.innerHTML = '<div class="card text-center"><p>No communities yet</p></div>';
        return;
      }
      
      container.innerHTML = Admin.communities.map(c => `
        <div class="card">
          <div class="card-header">
            <h3>${c.name}</h3>
            <span class="badge badge-primary">${c.members.length} members</span>
          </div>
          <div class="card-body">
            <p><strong>Location:</strong> ${c.location}</p>
            <p><strong>Description:</strong> ${c.description}</p>
            <p><strong>Invite Link:</strong> <code>${c.inviteLink}</code></p>
            <p><strong>Total Complaints:</strong> ${c.totalComplaints}</p>
          </div>
          <div class="card-footer">
            <button class="btn btn-secondary btn-sm" onclick="editCommunity('${c.id}')">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteCommunity('${c.id}')">Delete</button>
          </div>
        </div>
      `).join('');
    }
    
    function loadStaff() {
      const staff = Admin.staff;
      const tbody = document.getElementById('staff-table');
      
      if (staff.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center" style="color: var(--text-muted); padding: 2rem;">No staff members</td></tr>';
        return;
      }
      
      tbody.innerHTML = staff.map(s => {
        const assigned = Admin.complaints.filter(c => c.assignedTo === s.id).length;
        return `
          <tr>
            <td><strong>${s.name}</strong></td>
            <td>${s.email}</td>
            <td>${Admin.getCommunityName(s.communityId)}</td>
            <td>${assigned}</td>
            <td><button class="btn btn-sm btn-primary" onclick="viewStaffDetails('${s.id}')">View</button></td>
          </tr>
        `;
      }).join('');
    }
    
    function loadAuditLogs() {
      const logs = Admin.getAuditLogs().slice(0, 20);
      const tbody = document.getElementById('audit-table');
      
      if (logs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center" style="color: var(--text-muted); padding: 2rem;">No audit logs</td></tr>';
        return;
      }
      
      tbody.innerHTML = logs.map(log => `
        <tr>
          <td><small>${new Date(log.timestamp).toLocaleString()}</small></td>
          <td>${Auth.getUserById(log.adminId)?.name || 'Unknown'}</td>
          <td><span class="badge badge-info">${log.action}</span></td>
          <td>${log.entityType}</td>
          <td><small>${JSON.stringify(log.changes).substring(0, 50)}...</small></td>
        </tr>
      `).join('');
    }
    
    function filterAuditLogs() {
      // Implementation for audit log filtering
      loadAuditLogs();
    }
    
    function showComplaintModal(complaintId) {
      currentComplaintId = complaintId;
      const complaint = Admin.complaints.find(c => c.id === complaintId);
      if (!complaint) return;
      
      document.getElementById('modal-title').textContent = complaint.title;
      document.getElementById('modal-body').innerHTML = `
        <p><strong>Description:</strong> ${complaint.description}</p>
        <p><strong>Category:</strong> ${complaint.category}</p>
        <p><strong>Priority:</strong> ${complaint.priority}</p>
        <p><strong>Status:</strong> ${complaint.status}</p>
        <p><strong>Location:</strong> ${JSON.stringify(complaint.location)}</p>
        <p><strong>Created:</strong> ${new Date(complaint.createdAt).toLocaleString()}</p>
      `;
      
      document.getElementById('status-select').value = complaint.status;
      document.getElementById('staff-select').innerHTML = '<option value="">Assign to Staff...</option>' +
        Admin.staff.map(s => `<option value="${s.id}" ${complaint.assignedTo === s.id ? 'selected' : ''}>${s.name}</option>`).join('');
      
      document.getElementById('admin-note').value = '';
      
      document.getElementById('complaint-modal').classList.add('active');
    }
    
    function updateComplaintStatus() {
      const newStatus = document.getElementById('status-select').value;
      if (newStatus && currentComplaintId) {
        Admin.updateComplaintStatus(currentComplaintId, newStatus);
        RealTime.showSuccess('Status updated');
        const complaint = Admin.complaints.find(c => c.id === currentComplaintId);
        RealTime.broadcastComplaintUpdate(complaint);
        loadOverview();
        loadComplaints();
      }
    }
    
    function assignComplaintToStaff() {
      const staffId = document.getElementById('staff-select').value;
      if (staffId && currentComplaintId) {
        Admin.assignComplaint(currentComplaintId, staffId);
        RealTime.showSuccess('Complaint assigned');
        loadOverview();
        loadComplaints();
      }
    }
    
    function addAdminNote() {
      const note = document.getElementById('admin-note').value;
      if (note && currentComplaintId) {
        Admin.addNote(currentComplaintId, note);
        RealTime.showSuccess('Note added');
        document.getElementById('admin-note').value = '';
      }
    }
    
    function showCreateCommunityModal() {
      document.getElementById('community-form').reset();
      document.getElementById('community-modal').classList.add('active');
    }
    
    function setupRealTimeUpdates() {
      RealTime.subscribe('complaint-updated', () => {
        loadOverview();
        loadComplaints();
      });
      
      RealTime.subscribe('analytics-update', (analytics) => {
        renderStatusBreakdown(analytics.byStatus);
      });
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    function getStatusColor(status) {
      const colors = {
        'Pending': 'warning',
        'In Progress': 'info',
        'On Hold': 'warning',
        'Resolved': 'success'
      };
      return colors[status] || 'secondary';
    }
    
    function getPriorityColor(priority) {
      const colors = {
        'Low': 'primary',
        'Medium': 'info',
        'High': 'warning',
        'Urgent': 'danger'
      };
      return colors[priority] || 'secondary';
    }
    
    function editCommunity(communityId) {
      RealTime.showInfo('Edit community feature coming soon');
    }
    
    function deleteCommunity(communityId) {
      if (confirm('Are you sure?')) {
        Admin.deleteCommunity(communityId);
        RealTime.showSuccess('Community deleted');
        loadCommunities();
      }
    }
    
    function viewStaffDetails(staffId) {
      RealTime.showInfo('Staff details coming soon');
    }
    
    async function logout() {
      if (confirm('Logout?')) {
        await Auth.logout();
      }
    }
    
    function showSection(section) {
      document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      
      switch(section) {
        case 'overview':
          document.getElementById('overview-section').classList.remove('hidden');
          loadOverview();
          break;
        case 'complaints':
          document.getElementById('complaints-section').classList.remove('hidden');
          loadComplaints();
          break;
        case 'communities':
          document.getElementById('communities-section').classList.remove('hidden');
          break;
        case 'staff':
          document.getElementById('staff-section').classList.remove('hidden');
          break;
        case 'analytics':
          document.getElementById('analytics-section').classList.remove('hidden');
          break;
        case 'audit':
          document.getElementById('audit-section').classList.remove('hidden');
          break;
      }
      
      event.target.closest('.sidebar-link')?.classList.add('active');
    }
    
    // Community form submission
    document.getElementById('community-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        await Admin.createCommunity({
          name: document.getElementById('comm-name').value,
          location: document.getElementById('comm-location').value,
          description: document.getElementById('comm-description').value
        });
        RealTime.showSuccess('Community created');
        closeModal('community-modal');
        loadCommunities();
      } catch (error) {
        RealTime.showError(error);
      }
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', initAdminDashboard);
  </script>
</body>
</html>
